
# JDBC 访问数据库
	// beans.xml
	<context:component-scan base-package="com.smart" />
	
	<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"
		p:driverClassName="com.mysql.jdbc.Driver"
		p:url="jdbc:mysql://localhost:3306/spring"
		p:username="root"
		p:password="123456" />
	
	<bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate" 
		p:dataSource-ref="dataSource"/>
		
		
	
	@Service("userService")
	public class UserJdbcWithoutTransManagerService {
		@Autowired
		private JdbcTemplate jdbcTemplate;

		public void addScore(String userName,int toAdd){
			String sql = "UPDATE t_user u SET u.score = u.score + ? WHERE user_name =?";
			jdbcTemplate.update(sql,toAdd,userName);
		}

		public static void main(String[] args) {
			ApplicationContext ctx = new ClassPathXmlApplicationContext("com/smart/beanfactory/beans.xml");
			UserJdbcWithoutTransManagerService service = (UserJdbcWithoutTransManagerService)ctx.getBean("userService");
			JdbcTemplate jdbcTemplate = (JdbcTemplate)ctx.getBean("jdbcTemplate");
			BasicDataSource basicDataSource = (BasicDataSource)jdbcTemplate.getDataSource();
			//检查数据源autoCommit的设置
			System.out.println("autoCommit:"+ basicDataSource.getDefaultAutoCommit());
		   //插入一条记录，初始分数为10
			jdbcTemplate.execute("INSERT INTO t_user(user_name,password,score) VALUES('tom','123456',10)");
			//调用工作在无事务环境下的服务类方法,将分数添加20分
			service.addScore("tom",20);
			//查看此时用户的分数
			int score = jdbcTemplate.queryForObject("SELECT score FROM t_user WHERE user_name ='tom'", Integer.class);
			System.out.println("score:"+score);
			// jdbcTemplate.execute("DELETE FROM t_user WHERE user_name='tom'");
		}
	}
	
	/*
		autoCommit:true
		score:30
	*/
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	